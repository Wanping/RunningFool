
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/utils/eventCenter.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e7046XkjOZCpI7J1RIO+H/j', 'eventCenter');
// script/utils/eventCenter.js

"use strict";

function EventGroup() {
  this.head = null;
  this.iter = null;
  this.length = 0;

  EventGroup.prototype.getLength = function () {
    return this.length;
  };

  EventGroup.prototype.addObserver = function (observer, target) {
    if (observer == null) return;

    if (this.head == null) {
      this.head = {
        ob: observer,
        target: target,
        next: null
      };
      this.length = 1;
      return;
    }

    var node = this.head;
    var last = null;

    while (node != null) {
      if (node.ob === observer && node.target === target) {
        return;
      }

      last = node;
      node = node.next;
    }

    this.length += 1;
    last.next = {
      ob: observer,
      target: target,
      next: null
    };
  };

  EventGroup.prototype.removeObserver = function (observer, target) {
    if (observer == null || this.head == null) return;

    if (this.head.ob === observer && this.head.target === target) {
      if (this.head === this.iter) {
        this.iter = this.iter.next;
      }

      this.head = this.head.next;
      this.length--;
      return;
    }

    var node = this.head;

    while (node.next != null) {
      if (node.next.ob === observer && node.next.target === target) {
        if (this.iter === node.next) {
          this.iter = node.next.next;
        }

        node.next = node.next.next;
        this.length--;
        return;
      }

      node = node.next;
    }
  };

  EventGroup.prototype.removeAll = function () {
    this.iter = null;
    this.head = null;
    this.length = 0;
  };

  EventGroup.prototype.emitByArray = function (array) {
    this.iter = this.head;

    while (this.iter != null) {
      var temp = this.iter;

      if (temp.target) {
        temp.ob.call(temp.target, array);
      } else {
        temp.ob(array);
      }

      if (this.iter && temp === this.iter) {
        this.iter = this.iter.next;
      }
    }

    this.iter = null;
  };

  EventGroup.prototype.emit = function () {
    this.iter = this.head;

    while (this.iter != null) {
      var temp = this.iter;

      if (temp.target) {
        var _temp$ob;

        (_temp$ob = temp.ob).call.apply(_temp$ob, [temp.target].concat(Array.prototype.slice.call(arguments)));
      } else {
        temp.ob.apply(temp, arguments);
      }

      if (this.iter && temp === this.iter) {
        this.iter = this.iter.next;
      }
    }

    this.iter = null;
  };
}

var eventCenter = {
  _eventGroup: {},
  getEventGroup: function getEventGroup(evt) {
    return eventCenter._eventGroup[evt];
  },
  addEventObserver: function addEventObserver(evt, observer, target) {
    if (evt == null) {
      console.log("addEventObserver evt is null");
      return;
    }

    var eg = eventCenter.getEventGroup(evt);

    if (!eg) {
      eg = new EventGroup();
      eventCenter._eventGroup[evt] = eg;
    }

    eg.addObserver(observer, target);
  },
  removeEventObserver: function removeEventObserver(evt, observer, target) {
    if (evt == null) {
      console.log("removeEventObserver evt is null");
      return;
    }

    var eg = eventCenter.getEventGroup(evt);

    if (!eg) {
      eg.removeObserver(observer, target);

      if (eg.getLength() === 0) {
        delete eventCenter._eventGroup[evt];
      }
    }
  },
  emitEvent: function emitEvent(evt) {
    if (evt == null) {
      console.log("emitEvent evt is null");
      return;
    }

    var eg = eventCenter.getEventGroup(evt);

    if (eg) {
      for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        params[_key - 1] = arguments[_key];
      }

      eg.emit.apply(eg, params);
    }
  },
  emitEventByArray: function emitEventByArray(evt, array) {
    if (evt == null) {
      console.log("emitEventByArray evt is null");
      return;
    }

    var eg = eventCenter.getEventGroup(evt);

    if (eg) {
      eg.emitByArray(array);
    }
  },
  removeAll: function removeAll() {
    var eg = eventCenter._eventGroup;

    for (var key in eg) {
      eg[key].removeAll();
    }

    eventCenter._eventGroup = null;
  }
};
module.exports = eventCenter;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHQvdXRpbHMvZXZlbnRDZW50ZXIuanMiXSwibmFtZXMiOlsiRXZlbnRHcm91cCIsImhlYWQiLCJpdGVyIiwibGVuZ3RoIiwicHJvdG90eXBlIiwiZ2V0TGVuZ3RoIiwiYWRkT2JzZXJ2ZXIiLCJvYnNlcnZlciIsInRhcmdldCIsIm9iIiwibmV4dCIsIm5vZGUiLCJsYXN0IiwicmVtb3ZlT2JzZXJ2ZXIiLCJyZW1vdmVBbGwiLCJlbWl0QnlBcnJheSIsImFycmF5IiwidGVtcCIsImNhbGwiLCJlbWl0IiwiYXJndW1lbnRzIiwiZXZlbnRDZW50ZXIiLCJfZXZlbnRHcm91cCIsImdldEV2ZW50R3JvdXAiLCJldnQiLCJhZGRFdmVudE9ic2VydmVyIiwiY29uc29sZSIsImxvZyIsImVnIiwicmVtb3ZlRXZlbnRPYnNlcnZlciIsImVtaXRFdmVudCIsInBhcmFtcyIsImVtaXRFdmVudEJ5QXJyYXkiLCJrZXkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLFNBQVNBLFVBQVQsR0FBc0I7QUFFbEIsT0FBS0MsSUFBTCxHQUFZLElBQVo7QUFDQSxPQUFLQyxJQUFMLEdBQVksSUFBWjtBQUNBLE9BQUtDLE1BQUwsR0FBYyxDQUFkOztBQUVBSCxFQUFBQSxVQUFVLENBQUNJLFNBQVgsQ0FBcUJDLFNBQXJCLEdBQWlDLFlBQVk7QUFDekMsV0FBTyxLQUFLRixNQUFaO0FBQ0gsR0FGRDs7QUFJQUgsRUFBQUEsVUFBVSxDQUFDSSxTQUFYLENBQXFCRSxXQUFyQixHQUFtQyxVQUFVQyxRQUFWLEVBQW9CQyxNQUFwQixFQUE0QjtBQUMzRCxRQUFJRCxRQUFRLElBQUksSUFBaEIsRUFBc0I7O0FBQ3RCLFFBQUksS0FBS04sSUFBTCxJQUFhLElBQWpCLEVBQXVCO0FBQ25CLFdBQUtBLElBQUwsR0FBWTtBQUFDUSxRQUFBQSxFQUFFLEVBQUVGLFFBQUw7QUFBZUMsUUFBQUEsTUFBTSxFQUFDQSxNQUF0QjtB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QSxRQUFHSSxFQUFILEVBQU87QUFBQSx3Q0FOa0JHLE1BTWxCO0FBTmtCQSxRQUFBQSxNQU1sQjtBQUFBOztBQUNISCxNQUFBQSxFQUFFLENBQUNULElBQUgsT0FBQVMsRUFBRSxFQUFTRyxNQUFULENBQUY7QUFDSDtBQUNKLEdBN0NhO0FBK0NkQyxFQUFBQSxnQkFBZ0IsRUFBRSwwQkFBVVIsR0FBVixFQUFlUixLQUFmLEVBQXNCO0FBQ3BDLFFBQUdRLEdBQUcsSUFBSSxJQUFWLEVBQWdCO0FBQ1pFLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLDhCQUFaO0FBQ0E7QUFDSDs7QUFDRCxRQUFJQyxFQUFFLEdBQUdQLFdBQVcsQ0FBQ0UsYUFBWixDQUEwQkMsR0FBMUIsQ0FBVDs7QUFDQSxRQUFHSSxFQUFILEVBQU87QUFDSEEsTUFBQUEsRUFBRSxDQUFDYixXQUFILENBQWVDLEtBQWY7QUFDSDtBQUNKLEdBeERhO0FBMERkRixFQUFBQSxTQUFTLEVBQUUscUJBQVk7QUFDbkIsUUFBSWMsRUFBRSxHQUFHUCxXQUFXLENBQUNDLFdBQXJCOztBQUNBLFNBQUssSUFBSVcsR0FBVCxJQUFnQkwsRUFBaEIsRUFBb0I7QUFDaEJBLE1BQUFBLEVBQUUsQ0FBQ0ssR0FBRCxDQUFGLENBQVFuQixTQUFSO0FBQ0g7O0FBQ0RPLElBQUFBLFdBQVcsQ0FBQ0MsV0FBWixHQUEwQixJQUExQjtBQUNIO0FBaEVhLENBQWxCO0FBbUVBWSxNQUFNLENBQUNDLE9BQVAsR0FBaUJkLFdBQWpCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcbmZ1bmN0aW9uIEV2ZW50R3JvdXAoKSB7XG5cbiAgICB0aGlzLmhlYWQgPSBudWxsO1xuICAgIHRoaXMuaXRlciA9IG51bGw7XG4gICAgdGhpcy5sZW5ndGggPSAwO1xuXG4gICAgRXZlbnRHcm91cC5wcm90b3R5cGUuZ2V0TGVuZ3RoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgRXZlbnRHcm91cC5wcm90b3R5cGUuYWRkT2JzZXJ2ZXIgPSBmdW5jdGlvbiAob2JzZXJ2ZXIsIHRhcmdldCkge1xuICAgICAgICBpZiAob2JzZXJ2ZXIgPT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5oZWFkID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuaGVhZCA9IHtvYjogb2JzZXJ2ZXIsIHRhcmdldDp0YXJnZXQsIG5leHQ6IG51bGx9O1xuICAgICAgICAgICAgdGhpcy5sZW5ndGggPSAxO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHZhciBsYXN0ID0gbnVsbDtcbiAgICAgICAgd2hpbGUgKG5vZGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG5vZGUub2IgPT09IG9ic2VydmVyICYmIG5vZGUudGFyZ2V0ID09PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXN0ID0gbm9kZTtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sZW5ndGggKz0gMTtcbiAgICAgICAgbGFzdC5uZXh0ID0ge29iOiBvYnNlcnZlciwgdGFyZ2V0OiB0YXJnZXQsIG5leHQ6IG51bGx9O1xuICAgIH1cblxuICAgIEV2ZW50R3JvdXAucHJvdG90eXBlLnJlbW92ZU9ic2VydmVyID0gZnVuY3Rpb24gKG9ic2VydmVyLCB0YXJnZXQpIHtcbiAgICAgICAgaWYgKG9ic2VydmVyID09IG51bGwgfHwgdGhpcy5oZWFkID09IG51bGwpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuaGVhZC5vYiA9PT0gb2JzZXJ2ZXIgJiYgdGhpcy5oZWFkLnRhcmdldCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICBpZih0aGlzLmhlYWQgPT09IHRoaXMuaXRlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlciA9IHRoaXMuaXRlci5uZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5oZWFkID0gdGhpcy5oZWFkLm5leHQ7XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCAtLTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbm9kZSA9IHRoaXMuaGVhZDtcbiAgICAgICAgd2hpbGUgKG5vZGUubmV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAobm9kZS5uZXh0Lm9iID09PSBvYnNlcnZlciAmJiBub2RlLm5leHQudGFyZ2V0ID09PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVyID09PSBub2RlLm5leHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVyID0gbm9kZS5uZXh0Lm5leHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5vZGUubmV4dCA9IG5vZGUubmV4dC5uZXh0O1xuICAgICAgICAgICAgICAgIHRoaXMubGVuZ3RoIC0tO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBFdmVudEdyb3VwLnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaXRlciA9IG51bGw7XG4gICAgICAgIHRoaXMuaGVhZCA9IG51bGw7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICB9XG5cbiAgICBFdmVudEdyb3VwLnByb3RvdHlwZS5lbWl0QnlBcnJheSA9IGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgICB0aGlzLml0ZXIgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHdoaWxlICh0aGlzLml0ZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLml0ZXI7XG4gICAgICAgICAgICBpZiAodGVtcC50YXJnZXQpIHtcbiAgICAgICAgICAgICAgICB0ZW1wLm9iLmNhbGwodGVtcC50YXJnZXQsIGFycmF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRlbXAub2IoYXJyYXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pdGVyICYmIHRlbXAgPT09IHRoaXMuaXRlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlciA9IHRoaXMuaXRlci5uZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXRlciA9IG51bGw7XG4gICAgfVxuXG5cbiAgICBFdmVudEdyb3VwLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLml0ZXIgPSB0aGlzLmhlYWQ7XG4gICAgICAgIHdoaWxlICh0aGlzLml0ZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLml0ZXI7XG4gICAgICAgICAgICBpZiAodGVtcC50YXJnZXQpIHtcbiAgICAgICAgICAgICAgICB0ZW1wLm9iLmNhbGwodGVtcC50YXJnZXQsIC4uLmFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0ZW1wLm9iKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRoaXMuaXRlciAmJiB0ZW1wID09PSB0aGlzLml0ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZXIgPSB0aGlzLml0ZXIubmV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLml0ZXIgPSBudWxsO1xuICAgIH1cbn1cblxudmFyIGV2ZW50Q2VudGVyID0ge1xuXG4gICAgX2V2ZW50R3JvdXA6IHt9LFxuXG4gICAgZ2V0RXZlbnRHcm91cDogZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICByZXR1cm4gZXZlbnRDZW50ZXIuX2V2ZW50R3JvdXBbZXZ0XTtcbiAgICB9LFxuXG4gICAgYWRkRXZlbnRPYnNlcnZlcjogZnVuY3Rpb24gKGV2dCwgb2JzZXJ2ZXIsIHRhcmdldCkge1xuICAgICAgICBpZihldnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJhZGRFdmVudE9ic2VydmVyIGV2dCBpcyBudWxsXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGVnID0gZXZlbnRDZW50ZXIuZ2V0RXZlbnRHcm91cChldnQpO1xuICAgICAgICBpZiAoIWVnKSB7XG4gICAgICAgICAgICBlZyA9IG5ldyBFdmVudEdyb3VwKCk7XG4gICAgICAgICAgICBldmVudENlbnRlci5fZXZlbnRHcm91cFtldnRdID0gZWc7XG4gICAgICAgIH1cbiAgICAgICAgZWcuYWRkT2JzZXJ2ZXIob2JzZXJ2ZXIsIHRhcmdldCk7XG4gICAgfSxcblxuICAgIHJlbW92ZUV2ZW50T2JzZXJ2ZXI6IGZ1bmN0aW9uIChldnQsIG9ic2VydmVyLCB0YXJnZXQpIHtcbiAgICAgICAgaWYoZXZ0ID09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlRXZlbnRPYnNlcnZlciBldnQgaXMgbnVsbFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZWcgPSBldmVudENlbnRlci5nZXRFdmVudEdyb3VwKGV2dCk7XG4gICAgICAgIGlmICghZWcpIHtcbiAgICAgICAgICAgIGVnLnJlbW92ZU9ic2VydmVyKG9ic2VydmVyLCB0YXJnZXQpO1xuICAgICAgICAgICAgaWYgKGVnLmdldExlbmd0aCgpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGV2ZW50Q2VudGVyLl9ldmVudEdyb3VwW2V2dF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZW1pdEV2ZW50OiBmdW5jdGlvbiAoZXZ0LCAuLi5wYXJhbXMpIHtcbiAgICAgICAgaWYoZXZ0ID09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZW1pdEV2ZW50IGV2dCBpcyBudWxsXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBlZyA9IGV2ZW50Q2VudGVyLmdldEV2ZW50R3JvdXAoZXZ0KTtcbiAgICAgICAgaWYoZWcpIHtcbiAgICAgICAgICAgIGVnLmVtaXQoLi4ucGFyYW1zKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBlbWl0RXZlbnRCeUFycmF5OiBmdW5jdGlvbiAoZXZ0LCBhcnJheSkge1xuICAgICAgICBpZihldnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlbWl0RXZlbnRCeUFycmF5IGV2dCBpcyBudWxsXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBlZyA9IGV2ZW50Q2VudGVyLmdldEV2ZW50R3JvdXAoZXZ0KTtcbiAgICAgICAgaWYoZWcpIHtcbiAgICAgICAgICAgIGVnLmVtaXRCeUFycmF5KGFycmF5KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZW1vdmVBbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVnID0gZXZlbnRDZW50ZXIuX2V2ZW50R3JvdXA7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBlZykge1xuICAgICAgICAgICAgZWdba2V5XS5yZW1vdmVBbGwoKTtcbiAgICAgICAgfVxuICAgICAgICBldmVudENlbnRlci5fZXZlbnRHcm91cCA9IG51bGw7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBldmVudENlbnRlcjsiXX0=